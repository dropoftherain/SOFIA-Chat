<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SOFIA Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    #log { 
      white-space: pre-wrap;
      border: 2px solid #ddd;
      padding: 12px;
      min-height: 220px; 
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;          
      flex-direction: column; 
      gap: 8px;               
    }
    input, button { padding: 8px; }
    .me { color: #333; }
    .ai { color: #032925; }
    body {
      background-image: url('IMG_Backround.png');
      background-repeat: no-repeat;
      background-size: cover;
    }
  </style>
</head>
<body>
  <h1 style="color:rgb(0, 86, 65);">ChatBot for SOFIA Flow 88</h1>
  <div id="log"></div>
  <div style="margin-top:12px;">
    <input id="msg" size="60" placeholder="Ask in Englishâ€¦" />
    <button style="background-color: rgb(0, 86, 65); color:#ddd; border-radius: 5px;" id="send">Send</button>
  </div>

<script>
const log = document.getElementById('log');
const msg = document.getElementById('msg');

function appendMessage(text, cssClass) {
  const div = document.createElement('div');
  if (cssClass) div.className = cssClass;
  div.textContent = text;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight; // auto-scroll na koniec
}

async function send() {
  const m = msg.value.trim(); 
  if (!m) return;

  appendMessage(`You: ${m}`, 'me');

  msg.value = ''; 
  msg.focus();

  const r = await fetch('/api/chat', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ message: m })
  });

  const data = await r.json();

  if (data.answer) {
    appendMessage(`Chatbot Assistant: ${data.answer}`, 'ai');
  } else {
    appendMessage(`[Error] ${JSON.stringify(data)}`);
  }
}

document.getElementById('send').onclick = send;
msg.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });
</script>
</body>
</html>
